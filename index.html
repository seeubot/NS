<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Optimized viewport for TV -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="tv-screen" content="true">
    <title>StreamVault - Your Media Library</title>
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://cdn.tailwindcss.com" as="script">
    
    <!-- TV-optimized styles -->
    <style>
        /* Base TV-optimized styles */
        :root {
            --focus-color: #4ecdc4;
            --focus-shadow: 0 0 0 4px rgba(78, 205, 196, 0.5);
            --text-scale: 1.2; /* Larger text for TV viewing */
        }
        
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            font-size: calc(16px * var(--text-scale));
            touch-action: manipulation;
        }
        
        /* TV-optimized focus states */
        .focusable {
            transition: transform 0.1s ease, box-shadow 0.1s ease;
        }
        
        .focusable:focus {
            outline: none;
            transform: scale(1.05);
            box-shadow: var(--focus-shadow);
            z-index: 10;
        }
        
        /* Layout for TV screens */
        .tv-container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* TV-optimized media grid */
        .tv-media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            padding: 1rem;
        }
        
        /* Larger interactive elements for TV remote */
        .tv-button {
            min-width: 120px;
            min-height: 60px;
            padding: 1rem 2rem;
            font-size: 1.2rem;
        }
        
        /* Video player optimizations */
        .tv-video-player {
            width: 100%;
            height: 100%;
            background: #000;
        }
        
        /* Custom scrollbars that work on TV browsers */
        .tv-scrollable {
            scrollbar-width: none; /* Hide for Firefox */
        }
        
        .tv-scrollable::-webkit-scrollbar {
            display: none; /* Hide for Chrome/Safari */
        }
        
        /* Loading animation for TV */
        @keyframes tv-spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .tv-loading-spinner {
            border: 8px solid rgba(255, 255, 255, 0.3);
            border-top: 8px solid var(--focus-color);
            border-radius: 50%;
            width: 80px;
            height: 80px;
            animation: tv-spin 1s linear infinite;
        }
        
        /* Optimize for 10-foot UI (TV viewing distance) */
        @media (min-width: 1920px) {
            :root {
                --text-scale: 1.4;
            }
        }
    </style>
    
    <!-- Load Tailwind with TV-specific configuration -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    spacing: {
                        'tv-sm': '1rem',
                        'tv-md': '2rem',
                        'tv-lg': '3rem',
                        'tv-xl': '4rem'
                    },
                    fontSize: {
                        'tv-sm': '1.2rem',
                        'tv-md': '1.5rem',
                        'tv-lg': '2rem',
                        'tv-xl': '2.5rem'
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-900 text-gray-200">
    <!-- TV-optimized loading screen -->
    <div id="tv-loading-screen" class="fixed inset-0 flex items-center justify-center bg-gray-900 z-50">
        <div class="tv-loading-spinner"></div>
    </div>
    
    <!-- Main TV-optimized container -->
    <div id="tv-app" class="hidden tv-container">
        <!-- Search Section -->
        <div id="tv-search-container" class="flex flex-col items-center justify-center py-tv-xl">
            <input type="text" id="tv-search-input" 
                   class="focusable w-full max-w-2xl p-tv-md text-tv-md rounded-full bg-gray-800 text-white placeholder-gray-500 focus:outline-none focus:ring-4 focus:ring-teal-500"
                   placeholder="Search for movies or series...">
        </div>
        
        <!-- Content Area -->
        <div id="tv-content-area" class="hidden w-full">
            <!-- Header -->
            <header id="tv-header" class="flex flex-col md:flex-row items-center justify-between pb-tv-md border-b border-gray-700 mb-tv-md">
                <h1 class="text-tv-xl font-extrabold text-white">StreamVault</h1>
                <div id="tv-stats" class="flex items-center space-x-tv-lg mt-tv-md md:mt-0">
                    <!-- Stats will be populated by JS -->
                </div>
            </header>
            
            <!-- Navigation Tabs -->
            <div class="flex space-x-tv-md mb-tv-md border-b border-gray-700">
                <button id="tv-movies-tab" class="focusable tab-button py-tv-sm px-tv-md text-tv-md font-medium text-white border-b-4 border-teal-400">Movies</button>
                <button id="tv-series-tab" class="focusable tab-button py-tv-sm px-tv-md text-tv-md font-medium text-gray-400 hover:text-gray-200">Series</button>
            </div>
            
            <!-- Content Grid -->
            <div id="tv-media-grid" class="tv-media-grid"></div>
        </div>
    </div>
    
    <!-- TV Video Player -->
    <div id="tv-video-player" class="fixed inset-0 hidden bg-black z-40">
        <div class="absolute inset-0 flex items-center justify-center">
            <video id="tv-video-element" class="tv-video-player" playsinline webkit-playsinline></video>
            
            <!-- Loading Spinner -->
            <div id="tv-video-loading" class="absolute hidden">
                <div class="tv-loading-spinner"></div>
            </div>
            
            <!-- Video Controls -->
            <div id="tv-video-controls" class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-tv-md flex items-center space-x-tv-md opacity-0 transition-opacity duration-300">
                <button id="tv-play-pause" class="focusable text-white text-tv-xl bg-transparent p-tv-sm rounded-full">▶</button>
                <div class="flex-1">
                    <div id="tv-progress-bar" class="h-2 bg-gray-700 rounded-full">
                        <div id="tv-progress" class="h-full bg-teal-500 rounded-full w-0"></div>
                    </div>
                </div>
                <span id="tv-current-time" class="text-white text-tv-sm">00:00</span>
                <span class="text-white text-tv-sm">/</span>
                <span id="tv-duration" class="text-white text-tv-sm">00:00</span>
                <button id="tv-fullscreen" class="focusable text-white text-tv-xl bg-transparent p-tv-sm rounded-full">⛶</button>
            </div>
            
            <!-- Back Button -->
            <button id="tv-video-back" class="absolute top-tv-md left-tv-md focusable text-white text-tv-xl bg-gray-900 bg-opacity-70 p-tv-sm rounded-full">←</button>
        </div>
    </div>

    <!-- TV-optimized JavaScript -->
    <script>
        // Wait for DOM and critical resources to load
        document.addEventListener('DOMContentLoaded', () => {
            // API Configuration
            const TV_API_CONFIG = {
                baseUrl: 'https://future-ester-seeutech-645c6129.koyeb.app/api',
                endpoints: {
                    movies: '/movies',
                    series: '/series',
                    stats: '/stats'
                },
                cacheTTL: 3600000 // 1 hour cache
            };
            
            // DOM Elements
            const tvApp = document.getElementById('tv-app');
            const tvLoadingScreen = document.getElementById('tv-loading-screen');
            const tvSearchInput = document.getElementById('tv-search-input');
            const tvContentArea = document.getElementById('tv-content-area');
            const tvMediaGrid = document.getElementById('tv-media-grid');
            const tvMoviesTab = document.getElementById('tv-movies-tab');
            const tvSeriesTab = document.getElementById('tv-series-tab');
            const tvVideoPlayer = document.getElementById('tv-video-player');
            const tvVideoElement = document.getElementById('tv-video-element');
            const tvVideoControls = document.getElementById('tv-video-controls');
            const tvPlayPause = document.getElementById('tv-play-pause');
            const tvProgressBar = document.getElementById('tv-progress-bar');
            const tvProgress = document.getElementById('tv-progress');
            const tvCurrentTime = document.getElementById('tv-current-time');
            const tvDuration = document.getElementById('tv-duration');
            const tvFullscreen = document.getElementById('tv-fullscreen');
            const tvVideoBack = document.getElementById('tv-video-back');
            const tvVideoLoading = document.getElementById('tv-video-loading');
            
            // Application State
            const tvAppState = {
                allMovies: [],
                allSeries: [],
                currentMedia: null,
                currentSeries: null,
                activeTab: 'movies',
                focusIndex: 0,
                focusableElements: [],
                controlsTimeout: null,
                apiCache: {
                    movies: { data: null, timestamp: 0 },
                    series: { data: null, timestamp: 0 },
                    stats: { data: null, timestamp: 0 }
                }
            };
            
            // Initialize the TV application
            const initTVApp = () => {
                // Set up remote control navigation
                setupTVNavigation();
                
                // Load initial data
                loadInitialData();
                
                // Set up event listeners
                setupEventListeners();
                
                // Hide loading screen after everything is ready
                setTimeout(() => {
                    tvLoadingScreen.classList.add('hidden');
                    tvApp.classList.remove('hidden');
                    tvSearchInput.focus();
                }, 500);
            };
            
            // Set up remote control navigation
            const setupTVNavigation = () => {
                // Get all focusable elements
                tvAppState.focusableElements = Array.from(document.querySelectorAll('.focusable'));
                
                // Set initial focus
                if (tvAppState.focusableElements.length > 0) {
                    tvAppState.focusIndex = 0;
                    tvAppState.focusableElements[tvAppState.focusIndex].focus();
                }
                
                // Handle key events for remote control
                document.addEventListener('keydown', handleTVKeyPress);
            };
            
            // Handle TV remote key presses
            const handleTVKeyPress = (e) => {
                // Don't interfere with video player when it's active
                if (!tvVideoPlayer.classList.contains('hidden')) {
                    handleVideoPlayerKeyPress(e);
                    return;
                }
                
                switch (e.key) {
                    case 'ArrowUp':
                        moveFocus('up');
                        e.preventDefault();
                        break;
                    case 'ArrowDown':
                        moveFocus('down');
                        e.preventDefault();
                        break;
                    case 'ArrowLeft':
                        moveFocus('left');
                        e.preventDefault();
                        break;
                    case 'ArrowRight':
                        moveFocus('right');
                        e.preventDefault();
                        break;
                    case 'Enter':
                    case ' ':
                        if (tvAppState.focusableElements[tvAppState.focusIndex]) {
                            tvAppState.focusableElements[tvAppState.focusIndex].click();
                        }
                        e.preventDefault();
                        break;
                    case 'Backspace':
                    case 'Escape':
                        // Handle back navigation
                        e.preventDefault();
                        break;
                }
            };
            
            // Handle video player key presses
            const handleVideoPlayerKeyPress = (e) => {
                switch (e.key) {
                    case 'ArrowLeft':
                        tvVideoElement.currentTime = Math.max(0, tvVideoElement.currentTime - 10);
                        e.preventDefault();
                        break;
                    case 'ArrowRight':
                        tvVideoElement.currentTime = Math.min(tvVideoElement.duration, tvVideoElement.currentTime + 10);
                        e.preventDefault();
                        break;
                    case 'Enter':
                    case ' ':
                        togglePlayPause();
                        e.preventDefault();
                        break;
                    case 'MediaPlayPause':
                        togglePlayPause();
                        e.preventDefault();
                        break;
                    case 'Backspace':
                    case 'Escape':
                        closeVideoPlayer();
                        e.preventDefault();
                        break;
                    case 'f':
                    case 'F':
                        toggleFullscreen();
                        e.preventDefault();
                        break;
                }
            };
            
            // Move focus between elements
            const moveFocus = (direction) => {
                if (tvAppState.focusableElements.length === 0) return;
                
                // Remove focus from current element
                tvAppState.focusableElements[tvAppState.focusIndex].blur();
                
                // Calculate new focus index based on direction
                let newIndex = tvAppState.focusIndex;
                const gridItems = Array.from(tvMediaGrid.children);
                
                if (gridItems.length > 0 && gridItems.includes(tvAppState.focusableElements[tvAppState.focusIndex])) {
                    // Special handling for grid items
                    const currentGridIndex = gridItems.indexOf(tvAppState.focusableElements[tvAppState.focusIndex]);
                    const columns = Math.floor(tvMediaGrid.clientWidth / gridItems[0].clientWidth);
                    
                    switch (direction) {
                        case 'up':
                            newIndex = Math.max(0, currentGridIndex - columns);
                            break;
                        case 'down':
                            newIndex = Math.min(gridItems.length - 1, currentGridIndex + columns);
                            break;
                        case 'left':
                            newIndex = Math.max(0, currentGridIndex - 1);
                            break;
                        case 'right':
                            newIndex = Math.min(gridItems.length - 1, currentGridIndex + 1);
                            break;
                    }
                    
                    // Convert grid index to focusableElements index
                    const focusedElement = gridItems[newIndex];
                    newIndex = tvAppState.focusableElements.indexOf(focusedElement);
                } else {
                    // Default linear navigation for non-grid items
                    switch (direction) {
                        case 'up':
                        case 'left':
                            newIndex = (tvAppState.focusIndex - 1 + tvAppState.focusableElements.length) % tvAppState.focusableElements.length;
                            break;
                        case 'down':
                        case 'right':
                            newIndex = (tvAppState.focusIndex + 1) % tvAppState.focusableElements.length;
                            break;
                    }
                }
                
                // Update focus index and apply focus
                tvAppState.focusIndex = newIndex;
                tvAppState.focusableElements[tvAppState.focusIndex].focus();
            };
            
            // Load initial data
            const loadInitialData = async () => {
                try {
                    // Try to load from cache first
                    const now = Date.now();
                    if (tvAppState.apiCache.movies.data && now - tvAppState.apiCache.movies.timestamp < TV_API_CONFIG.cacheTTL) {
                        tvAppState.allMovies = tvAppState.apiCache.movies.data;
                    } else {
                        const moviesResponse = await fetch(TV_API_CONFIG.baseUrl + TV_API_CONFIG.endpoints.movies);
                        tvAppState.allMovies = await moviesResponse.json();
                        tvAppState.apiCache.movies = { data: tvAppState.allMovies, timestamp: now };
                    }
                    
                    if (tvAppState.apiCache.series.data && now - tvAppState.apiCache.series.timestamp < TV_API_CONFIG.cacheTTL) {
                        tvAppState.allSeries = tvAppState.apiCache.series.data;
                    } else {
                        const seriesResponse = await fetch(TV_API_CONFIG.baseUrl + TV_API_CONFIG.endpoints.series);
                        tvAppState.allSeries = await seriesResponse.json();
                        tvAppState.apiCache.series = { data: tvAppState.allSeries, timestamp: now };
                    }
                    
                    if (tvAppState.apiCache.stats.data && now - tvAppState.apiCache.stats.timestamp < TV_API_CONFIG.cacheTTL) {
                        updateTVStats(tvAppState.apiCache.stats.data);
                    } else {
                        const statsResponse = await fetch(TV_API_CONFIG.baseUrl + TV_API_CONFIG.endpoints.stats);
                        const stats = await statsResponse.json();
                        tvAppState.apiCache.stats = { data: stats, timestamp: now };
                        updateTVStats(stats);
                    }
                } catch (error) {
                    console.error('Failed to load initial data:', error);
                    // Fallback to empty state
                }
            };
            
            // Update stats display
            const updateTVStats = (stats) => {
                const statsContainer = document.getElementById('tv-stats');
                if (!statsContainer) return;
                
                statsContainer.innerHTML = `
                    <div class="flex flex-col items-center">
                        <span class="text-tv-lg font-bold text-teal-400">${stats.movies || 0}</span>
                        <span class="text-tv-sm text-gray-400">Movies</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <span class="text-tv-lg font-bold text-purple-400">${stats.series || 0}</span>
                        <span class="text-tv-sm text-gray-400">Series</span>
                    </div>
                    <div class="flex flex-col items-center">
                        <span class="text-tv-lg font-bold text-orange-400">${stats.episodes || 0}</span>
                        <span class="text-tv-sm text-gray-400">Episodes</span>
                    </div>
                `;
            };
            
            // Set up event listeners
            const setupEventListeners = () => {
                // Search input
                tvSearchInput.addEventListener('input', handleTVSearch);
                
                // Tab navigation
                tvMoviesTab.addEventListener('click', () => switchTVTab('movies'));
                tvSeriesTab.addEventListener('click', () => switchTVTab('series'));
                
                // Video player controls
                tvPlayPause.addEventListener('click', togglePlayPause);
                tvFullscreen.addEventListener('click', toggleFullscreen);
                tvVideoBack.addEventListener('click', closeVideoPlayer);
                tvProgressBar.addEventListener('click', handleProgressBarClick);
                
                // Video element events
                tvVideoElement.addEventListener('play', handleVideoPlay);
                tvVideoElement.addEventListener('pause', handleVideoPause);
                tvVideoElement.addEventListener('timeupdate', updateVideoProgress);
                tvVideoElement.addEventListener('loadedmetadata', updateVideoDuration);
                tvVideoElement.addEventListener('waiting', showVideoLoading);
                tvVideoElement.addEventListener('playing', hideVideoLoading);
                tvVideoElement.addEventListener('error', handleVideoError);
                
                // Show controls when video player is interacted with
                tvVideoPlayer.addEventListener('mousemove', showVideoControls);
                tvVideoPlayer.addEventListener('mouseleave', hideVideoControls);
                tvVideoPlayer.addEventListener('keydown', () => showVideoControls());
                
                // Handle focus changes
                document.addEventListener('focusin', () => {
                    // Update focus index when focus changes
                    const focusedElement = document.activeElement;
                    const index = tvAppState.focusableElements.indexOf(focusedElement);
                    if (index !== -1) {
                        tvAppState.focusIndex = index;
                    }
                });
            };
            
            // Handle search
            const handleTVSearch = () => {
                const query = tvSearchInput.value.trim().toLowerCase();
                
                if (query.length < 2) {
                    tvContentArea.classList.add('hidden');
                    return;
                }
                
                tvContentArea.classList.remove('hidden');
                
                // Filter media based on query
                const filteredMovies = tvAppState.allMovies.filter(movie => 
                    movie.name.toLowerCase().includes(query)
                );
                
                const filteredSeries = tvAppState.allSeries.filter(series => 
                    series.name.toLowerCase().includes(query)
                );
                
                // Update stats based on filtered results
                const filteredStats = {
                    movies: filteredMovies.length,
                    series: filteredSeries.length,
                    episodes: filteredSeries.reduce((total, series) => 
                        total + (series.seasons?.reduce((seasonTotal, season) => 
                            seasonTotal + (season.episodes?.length || 0), 0) || 0), 0)
                };
                
                updateTVStats(filteredStats);
                renderTVMedia(filteredMovies, filteredSeries);
            };
            
            // Switch between movies and series tabs
            const switchTVTab = (tab) => {
                tvAppState.activeTab = tab;
                
                // Update tab styling
                if (tab === 'movies') {
                    tvMoviesTab.classList.add('text-white', 'border-teal-400');
                    tvMoviesTab.classList.remove('text-gray-400');
                    tvSeriesTab.classList.add('text-gray-400');
                    tvSeriesTab.classList.remove('text-white', 'border-purple-400');
                } else {
                    tvSeriesTab.classList.add('text-white', 'border-purple-400');
                    tvSeriesTab.classList.remove('text-gray-400');
                    tvMoviesTab.classList.add('text-gray-400');
                    tvMoviesTab.classList.remove('text-white', 'border-teal-400');
                }
                
                // Re-render content based on current search
                handleTVSearch();
            };
            
            // Render media grid
            const renderTVMedia = (movies, series) => {
                tvMediaGrid.innerHTML = '';
                
                const mediaToRender = tvAppState.activeTab === 'movies' ? movies : series;
                const mediaType = tvAppState.activeTab === 'movies' ? 'movie' : 'series';
                
                if (mediaToRender.length === 0) {
                    tvMediaGrid.innerHTML = `
                        <div class="col-span-full text-center text-gray-500 py-tv-xl">
                            No ${tvAppState.activeTab} found matching your search.
                        </div>
                    `;
                    return;
                }
                
                mediaToRender.forEach(item => {
                    const card = createTVMediaCard(item, mediaType);
                    tvMediaGrid.appendChild(card);
                });
                
                // Update focusable elements after rendering new content
                tvAppState.focusableElements = Array.from(document.querySelectorAll('.focusable'));
            };
            
            // Create a media card
            const createTVMediaCard = (item, type) => {
                const card = document.createElement('div');
                card.className = 'focusable media-card bg-gray-800 rounded-xl overflow-hidden shadow-lg transition-transform duration-200';
                card.tabIndex = 0;
                
                const thumbnail = item.thumbnail || 'https://placehold.co/400x600/1f2937/d1d5db?text=No+Image';
                const seasonsInfo = type === 'series' && item.seasons 
                    ? `<p class="text-tv-sm text-gray-400 mt-tv-sm">${item.seasons.length} ${item.seasons.length === 1 ? 'season' : 'seasons'}</p>`
                    : '';
                
                card.innerHTML = `
                    <img src="${thumbnail}" alt="${item.name}" class="w-full h-64 object-cover" loading="lazy">
                    <div class="p-tv-md">
                        <h3 class="text-tv-md font-semibold text-white truncate">${item.name}</h3>
                        ${seasonsInfo}
                    </div>
                `;
                
                card.addEventListener('click', () => {
                    if (type === 'series') {
                        loadTVSeriesDetails(item);
                    } else {
                        playTVVideo(item);
                    }
                });
                
                return card;
            };
            
            // Load series details
            const loadTVSeriesDetails = async (series) => {
                try {
                    // Show loading state
                    tvAppState.currentSeries = series;
                    
                    if (series.seasons && series.seasons.length > 0 && 
                        series.seasons[0].episodes && series.seasons[0].episodes.length > 0) {
                        const firstEpisode = series.seasons[0].episodes[0];
                        playTVVideo({
                            ...firstEpisode,
                            thumbnail: series.thumbnail,
                            seriesName: series.name
                        });
                    }
                } catch (error) {
                    console.error('Error loading series details:', error);
                }
            };
            
            // Play video
            const playTVVideo = (mediaItem) => {
                if (!mediaItem || !mediaItem.streamingUrl) return;
                
                tvAppState.currentMedia = mediaItem;
                tvVideoElement.src = mediaItem.streamingUrl;
                tvVideoPlayer.classList.remove('hidden');
                
                // Attempt to play
                const playPromise = tvVideoElement.play();
                
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.error('Error attempting to play video:', error);
                    });
                }
                
                // Update focusable elements (now in video player mode)
                tvAppState.focusableElements = [
                    tvPlayPause,
                    tvFullscreen,
                    tvVideoBack
                ];
                
                tvAppState.focusIndex = 0;
                tvAppState.focusableElements[tvAppState.focusIndex].focus();
            };
            
            // Video control functions
            const togglePlayPause = () => {
                if (tvVideoElement.paused) {
                    tvVideoElement.play().catch(console.error);
                } else {
                    tvVideoElement.pause();
                }
            };
            
            const toggleFullscreen = () => {
                if (!document.fullscreenElement) {
                    tvVideoPlayer.requestFullscreen().catch(console.error);
                } else {
                    document.exitFullscreen();
                }
            };
            
            const closeVideoPlayer = () => {
                tvVideoElement.pause();
                tvVideoElement.src = '';
                tvVideoPlayer.classList.add('hidden');
                tvAppState.currentMedia = null;
                tvAppState.currentSeries = null;
                
                // Restore focus to main content
                tvAppState.focusableElements = Array.from(document.querySelectorAll('.focusable'));
                tvAppState.focusIndex = 0;
                if (tvAppState.focusableElements.length > 0) {
                    tvAppState.focusableElements[tvAppState.focusIndex].focus();
                }
            };
            
            const handleProgressBarClick = (e) => {
                const rect = tvProgressBar.getBoundingClientRect();
                const pos = (e.clientX - rect.left) / rect.width;
                tvVideoElement.currentTime = pos * tvVideoElement.duration;
            };
            
            // Video event handlers
            const handleVideoPlay = () => {
                tvPlayPause.textContent = '⏸';
                hideVideoLoading();
            };
            
            const handleVideoPause = () => {
                tvPlayPause.textContent = '▶';
            };
            
            const updateVideoProgress = () => {
                const percent = (tvVideoElement.currentTime / tvVideoElement.duration) * 100;
                tvProgress.style.width = `${percent}%`;
                tvCurrentTime.textContent = formatTVTime(tvVideoElement.currentTime);
            };
            
            const updateVideoDuration = () => {
                tvDuration.textContent = formatTVTime(tvVideoElement.duration);
            };
            
            const showVideoLoading = () => {
                tvVideoLoading.classList.remove('hidden');
            };
            
            const hideVideoLoading = () => {
                tvVideoLoading.classList.add('hidden');
            };
            
            const handleVideoError = () => {
                showVideoLoading();
                setTimeout(() => {
                    if (tvVideoElement.error) {
                        closeVideoPlayer();
                    }
                }, 2000);
            };
            
            const showVideoControls = () => {
                tvVideoControls.classList.remove('opacity-0');
                clearTimeout(tvAppState.controlsTimeout);
                tvAppState.controlsTimeout = setTimeout(() => {
                    tvVideoControls.classList.add('opacity-0');
                }, 3000);
            };
            
            const hideVideoControls = () => {
                tvVideoControls.classList.add('opacity-0');
                clearTimeout(tvAppState.controlsTimeout);
            };
            
            // Helper functions
            const formatTVTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            };
            
            // Initialize the app
            initTVApp();
        });
    </script>
</body>
</html>
